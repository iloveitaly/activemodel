Take a look at this patched function from an external package. The assertion that is in place is breaking because the upstream package was mutated.

I want you to investigate the changes in that function between The current version of that package that is used in this project and the most recent version. Take a look at our patch and:

1. Update it if necessary to be compatible with the latest logic and the upstream function.
2. Provide a summary of the changes made in the latest version of that function.
